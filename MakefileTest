# Makefile for a C++ project with unittest

# Compiler settings
CXX = g++
CXXFLAGS = -Wall
CXXFLAGS += -I"$(CPPUTEST_HOME)/include"
CXXFLAGS += -include "$(CPPUTEST_HOME)/include/CppUTest/MemoryLeakDetectorNewMacros.h"
CFLAGS += -include "$(CPPUTEST_HOME)/include/CppUTest/MemoryLeakDetectorMallocMacros.h"

LDFLAGS = -L"$(CPPUTEST_HOME)/lib"
LDLIBS = -lCppUTest -lCppUTestExt

# Target executable name
TARGET = unittest.exe

# Object files
OBJS = test/unittest.o test/bowling.o

# Build target
all: $(TARGET)

# Rule to link the program
$(TARGET): $(OBJS) | test
	$(CXX) -pthread $(LDFLAGS) $(OBJS) -o $(TARGET) $(LDLIBS)

# Rule to compile the unittest source file
test/unittest.o: unittest.cpp bowling.h | test
	$(CXX) $(CXXFLAGS) -c unittest.cpp -o test/unittest.o

# Rule to compile the bowling source file
test/bowling.o: bowling.c bowling.h | test
	$(CXX) $(CXXFLAGS) -c bowling.c -o test/bowling.o

test:
	mkdir test

# Clean target
clean:
	rm -rf test/*.o
	rm  $(TARGET)
	del "test\*.o"
	del "$(TARGET)"
